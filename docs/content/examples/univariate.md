# Example Tesseract: The Rosenbrock function

This example demonstrates how to:

1. Create a Tesseract that wraps the [Rosenbrock
function](https://en.wikipedia.org/wiki/Rosenbrock_function), a non-convex
function that is commonly used to test optimization algorithms.

2. Use the tesseract with Scipy's `minimize` routine to find the minimum of the Rosenbrock function.

```{figure} ../../img/rosenbrock_optimization.gif
:alt: Optimization trajectory on the Rosenbrock function.
:align: center
:width: 80%

Optimization trajectory on the Rosenbrock tesseract.
```

For (2) we define all endpoints, including the [optional AD endpoints](../introduction/differentiable-programming.md).

```{seealso}
For many more examples, see the `examples/` directory in the Tesseract repository, or download them {download}`here </downloads/examples.zip>`.
```

## Tesseract definition

In this section we walk you through each step to re-create the example in
`examples/unit_tesseract/univariate/`.

The easiest way to set up a new tesseract is with the `init` command, which will create
three files:

```bash
$ tesseract init --name univariate --target-dir
$ ls your/path/to/univariate
tesseract_config.yaml
tesseract_requirements.txt
tesseract_api.py
```

### `tesseract_config.yaml`

The config file of the tesseract. Here you can specify the docker
`base_image`, extra (non-python) packages you might want to install, and much
more. We modify the config that was generated by `tesseract init`:

```{literalinclude} ../../../examples/unit_tesseracts/univariate/tesseract_config.yaml
```

### `tesseract_requirements.txt`
Specifies all python dependecies of your tesseract.
```{literalinclude} ../../../examples/unit_tesseracts/univariate/tesseract_requirements.txt
```

### `tesseract_api.py`

The actual implementation of the tesseract. In the first few lines we define the
`rosenbrock` function itself, then we specify the `InputSchema` and
`OutputSchema`, which essentially mimic the type signature of `rosenbrock`.
```{literalinclude} ../../../examples/unit_tesseracts/univariate/tesseract_api.py
  :lines: 3-40
```

At this point you could already build the tesseract and evaluate the Rosenbrock
function with

```bash
$ tesseract build examples/unit_tesseracts/univariate
$ tesseract run univariate apply '{"inputs": {"x":1, "y":1}}'
{
  "result": {
    "object_type": "array",
    "shape": [],
    "dtype": "float64",
    "data": {
      "buffer": 0.0,
      "encoding": "json"
    }
  }
}
```
The `result` contains a json encoded singleton array (with shape `[]`).

The rest of the `tesseract_api.py` defines the AD endpoints to enable computing the gradient.


## Tesseract usage via the Python API

To use a built tesseract, you can serve it by name, which will make it available
at `http://localhost:<PORT>`.

```bash
$ tesseract serve univariate
 [i] Waiting for Tesseract containers to start ...
 [i] Container ID: 45c84bca8caa2d39e27fc1b01129c17f51ad19f781ede07b9275623fb4da65d2
 [i] Name: tesseract-flivhk7muce0-sha256-glfafackzws6-1
 [i] Entrypoint: ['tesseract-runtime', 'serve']
 [i] View Tesseract: http://localhost:58354/docs
 [i] Docker Compose Project ID, use it with 'tesseract teardown' command: tesseract-flivhk7muce0
{"project_id": "tesseract-flivhk7muce0", "containers": [{"name": "tesseract-flivhk7muce0-sha256-glfafackzws6-1", "port": "58354"}]}%
```

The served tesseract can be conveniently used via the python API
```{literalinclude} ../../../examples/unit_tesseracts/univariate/optimize.py
```
