[project]
name = "tesseract-core"
description = "A toolkit for universal, autodiff-native software components."
readme = "README.md"
authors = [
    {name = "The Tesseract team @ Pasteur Labs + OSS contributors", email = "info@simulation.science"},
]
license = { text = "Apache-2.0" }
requires-python = ">=3.10,<3.14"
dependencies = [
    "jinja2",
    "rich",
    "typer",
    "pyyaml",
    "pydantic",
    "numpy",
    "requests>=2.32.4",
    "pip",
]
dynamic = [
    # Injected via hatch-vcs
    "version",
]

[project.scripts]
tesseract = "tesseract_core.sdk.cli:entrypoint"
tesseract-runtime = "tesseract_core.runtime.cli:main"

[project.optional-dependencies]

# RUNTIME DEPENDENCIES
# These are the only dependencies that are installed into Tesseract containers, so may contain duplicates of deps above.
# They should be kept minimal and stable at all times.
#
# NOTE: Upper bounds (<=) on runtime deps are periodically updated via .github/workflows/bump_lockfile.yml,
# do not edit manually. To add constraints, use other operators (e.g. <, >=, ~=, ==) as needed.
runtime = [
    "pydantic<=2.12.5,>=2.10",
    "fastapi<=0.131.0,>=0.115",
    "requests<=2.32.5,>=2.32.4",
    "uvicorn<=0.41.0,>=0.34",
    "click<=8.3.1,>=8.1",
    "typer<=0.24.1,>=0.15",
    "fsspec[http,s3]<=2026.2.0,>=2024.12",
    "pybase64<=1.4.3,>=1.4",
    "numpy<=2.4.2,>=1.26",
    "debugpy<=1.8.20,>=1.8.14",
    "mlflow-skinny<=3.10.0,>=3.7.0",
]
# END RUNTIME DEPENDENCIES

docs = [
    "sphinx<9",  # TODO: Remove when https://github.com/click-contrib/sphinx-click/pull/160 is merged
    "sphinx_autodoc_typehints",
    "furo",
    "myst-nb",
    "sphinx_click",
    "autodoc_pydantic",
    "sphinx_design",
    "sphinx_copybutton",
    "sphinxext_opengraph",
    "tesseract-core[runtime]",
]
dev = [
    "docker",
    "fastapi",
    "httpx",  # required by fastapi test client
    "jsf",
    "numpy",
    "pre-commit",
    "pytest",
    "pytest-cov",
    "pytest-mock",
    "moto[server]",
    "aiobotocore>=2.19.0",  # without this pip dependency resolution fails
    "typeguard",
    # also add all other extras here
    "tesseract-core[runtime]",
    "tesseract-core[docs]",
]

[project.urls]
Homepage = "https://github.com/pasteurlabs/tesseract-core"
Documentation = "https://docs.pasteurlabs.ai/projects/tesseract-core/latest"

[build-system]
requires = ["hatchling", "hatch-vcs", "setuptools-scm!=9.0.0"]
build-backend = "hatchling.build"

[tool.hatch.version]
source = "vcs"

[tool.hatch.build.hooks.vcs]
version-file = "tesseract_core/_version.py"

[tool.hatch.build.targets.wheel]
packages = ["tesseract_core"]


[tool.pytest.ini_options]
addopts = ["--typeguard-packages=tesseract_core"]
testpaths = ["tests"]
filterwarnings = [
    "error",
    # ignored by default
    "ignore::DeprecationWarning",
    "ignore::PendingDeprecationWarning",
    "ignore::ImportWarning",
    # raised by Cython, usually harmless
    "ignore:numpy.dtype size changed",
    "ignore:numpy.ufunc size changed",
    # sometimes, dependencies leak resources
    "ignore:.*socket\\.socket.*:pytest.PytestUnraisableExceptionWarning",
    "ignore:.*sqlite3\\.Connection.*:pytest.PytestUnraisableExceptionWarning",
]

[tool.coverage.run]
branch = true
source = ["tesseract_core"]

[tool.coverage.report]
exclude_lines = [
    "pragma: no cover",
    "raise NotImplementedError",
    "if __name__ == .__main__.:",
    "pass",
]
ignore_errors = true
omit = [
    "tesseract_core/_version.py",
]
